From [[Wk5 - Pwning 2 Class]]
[Article from Medium](https://medium.com/swlh/binary-exploitation-attacking-dynamic-linking-57d00ae56a83)
There are two types of binaries:
* **Statically linked binaries**
	* Do not depend on external libraries
	* All of the code and dependencies are contained within the binary itself
* **Dynamically linked binaries**
	* Rely on shared libraries for parts of their functionality
	* Processes share code
		* Eliminates the need to store shared library code in every single eexecutable
## How it works
When a dynamically-linked ELF binary calls a function in a shared library (Ex: `printf`), the call points to the **Procedure Linkage Table** (PLT).
* The PLT contains code stubs that direct the program to look up function addresses
* Located at the `.plt` section in the code
These function addresses are stored in the **Global Offset Table** (GOT)
* Located at the `.got.plt` section
* The GOT contains either:
	* A pointer back to the PLT to invoke the dynamic linker
	* A pointer pointing to the shared library function
		Ex: The actual address of `printf`

The first time a function is called, the **dynamic linker** is called to locate the actual address of the library function.
* It writes that location into the GOT
* In later calls to the library function, the program can directly retrieve the location of the function from the GOT
* We call this "*lazy binding*"
###### Lazy Binding
Binding a function is computationally expensive
* Locate the library
* Write address to the GOT
Lazy binding allows programs to defer the cost to when the function is actually called
* Some programs may include a shared function but never call it (depending on the program control flow)

## Attacking the Dynamic Linking Process
The Global Offset Table is essentially a giant pointer array that points to functions in shared libraries.
* Th addresses in GOT are lazily bound by default
* Therefore **the GOT MUST have writeable memory!!!**
If the GOT is loaded at a fixed address, an attacker can locate and overwrite addresses in the GOT
* Compiling the binary as a PIE will prevent this
* The attacker needs a bug that allows the arbitrary write of a single address
	* Then they can overwrite the address in GOT and redirect the program flow to another function or ROP gadget.
		Ex: The attacker can make the program call `system` instead of `printf`
		See [[Git it GOT it, Good]]/[[GGG Writeup]] for a demo
	* This is a *GOT Overwrite Attack*
## Mitigations
### Relocation Read-Only (RELRO)
**RELRO** is a mitigation technique meant to prevent GOT overwrites
* Forces the linker to resolve all dynamically-linked functions at the start of program
* Populates the GOT at the start too
* Marks GOT as read only afterwards
Full RELRO
* Attempts to overwrite GOT will cause the program to crash
	* Therefore preventing arbitrary code execution
* This setting will increase program startup time
	* All symbols are resolved in advance
### Other Potential Risks
Even if an attacker can't overwrite the GOT, they're still a good target to redirect program flow
* Often link to useful functions such as `system` and `execve`
When the GOT and PLT don't have randomized addresses, these sections may help an attacker bypass other binary exploitation mitigation techniques such as Address Space Layout Randomization